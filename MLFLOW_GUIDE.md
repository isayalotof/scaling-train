# MLflow: ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¸Ñ‡ĞºĞ° Ğ¿Ğ¾ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ taxi_fare_prediction

> Ğ’ĞµÑ€ÑĞ¸Ñ: 1.0 | ĞŸÑ€Ğ¾ĞµĞºÑ‚: NYC Taxi Fare Prediction | Ğ¡Ñ‚ĞµĞº: LightGBM + Optuna + MLflow

---

## Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· MLflow â€” Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ ÑÑ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾](#1-Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°-Ğ±ĞµĞ·-mlflow--Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ-Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ-ÑÑ‚Ğ¾-Ğ½ÑƒĞ¶Ğ½Ğ¾)
2. [Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ MLflow](#2-Ñ‡Ñ‚Ğ¾-Ñ‚Ğ°ĞºĞ¾Ğµ-mlflow)
3. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° MLflow â€” Ğ²ÑĞµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ¸Ñ](#3-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-mlflow--Ğ²ÑĞµ-ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ-Ğ¿Ğ¾Ğ½ÑÑ‚Ğ¸Ñ)
4. [Ğ§Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ¼Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚](#4-Ñ‡Ñ‚Ğ¾-Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾-Ğ¼Ñ‹-Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸-Ğ²-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚)
5. [Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº](#5-ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°-Ğ¸-Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹-Ğ·Ğ°Ğ¿ÑƒÑĞº)
6. [MLflow UI â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°](#6-mlflow-ui--Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹-Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°)
7. [Ğ§Ñ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğµ Ğ¸ Ğ·Ğ°Ñ‡ĞµĞ¼](#7-Ñ‡Ñ‚Ğ¾-Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ-Ğ²-Ğ½Ğ°ÑˆĞµĞ¼-Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğµ-Ğ¸-Ğ·Ğ°Ñ‡ĞµĞ¼)
8. [ĞšĞ°Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ](#8-ĞºĞ°Ğº-Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ-Ğ¸-Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ-ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½ÑƒÑ-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ)
9. [Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ² â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸](#9-ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ-Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ²--Ğ¿Ğ¾Ğ¸ÑĞº-Ğ»ÑƒÑ‡ÑˆĞµĞ¹-Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
10. [ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸](#10-Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ-Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸)
11. [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ](#11-Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°-Ğ´Ğ»Ñ-Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹-Ğ²-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ)
12. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ](#12-ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²-Ğ½Ğ°-Ğ´Ğ¸ÑĞºĞµ)
13. [Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Ğ¸Ñ… Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ](#13-Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ-Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸-Ğ¸-Ğ¸Ñ…-Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ)
14. [Ğ¨Ğ¿Ğ°Ñ€Ğ³Ğ°Ğ»ĞºĞ° Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼](#14-ÑˆĞ¿Ğ°Ñ€Ğ³Ğ°Ğ»ĞºĞ°-Ğ¿Ğ¾-ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼)

---

## 1. ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· MLflow â€” Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ ÑÑ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾

ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ ML-Ğ¸Ğ½Ğ¶ĞµĞ½ĞµÑ€Ğ° Ğ±ĞµĞ· MLflow:

```
ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº: Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ» Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ learning_rate=0.05, Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» RMSE=3.24
Ğ’Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº:     Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞ» num_leaves=128, RMSE ÑÑ‚Ğ°Ğ» 3.11 â€” Ğ»ÑƒÑ‡ÑˆĞµ!
Ğ¡Ñ€ĞµĞ´Ğ°:        Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞ» ĞµÑ‰Ñ‘ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾... RMSE=3.40 â€” Ñ…ÑƒĞ¶Ğµ
Ğ§ĞµÑ‚Ğ²ĞµÑ€Ğ³:      Ğ¿Ñ‹Ñ‚Ğ°ÑÑÑŒ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ "Ñ‚Ğ¾Ñ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚"... Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ±Ñ‹Ğ»?
ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ°:      :(
```

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ°ÑÑ‚ Ğ±ĞµĞ· ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ ÑƒÑ‡Ñ‘Ñ‚Ğ°:

| ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ |
|----------|---------------|
| **ĞĞµÑ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸** | ĞĞµĞ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ»Ğ¸ Ğ²Ñ‡ĞµÑ€Ğ°, Ğ½ĞµĞ´ĞµĞ»Ñ Ğ½Ğ°Ğ·Ğ°Ğ´ |
| **ĞĞµÑ‚ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸** | ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ²Ğ¾ÑÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ "Ñ‚Ğ¾Ñ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº" |
| **ĞĞµÑ‚ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ** | Ğ“Ğ»Ğ°Ğ·Ğ°Ğ¼Ğ¸ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ‡Ğ¸ÑĞ»Ğ° Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ¾Ğ² |
| **ĞĞµÑ‚ Ğ²ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸** | model.pkl Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ· |
| **ĞĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ²** | ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ³Ğ´Ğµ-Ñ‚Ğ¾ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ, ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ Ğ³Ğ´Ğµ-Ñ‚Ğ¾ ĞµÑ‰Ñ‘ |
| **Ğ’ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ â€” Ñ…Ğ°Ğ¾Ñ** | ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²ĞµĞ´Ñ‘Ñ‚ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ… |

**MLflow Ñ€ĞµÑˆĞ°ĞµÑ‚ Ğ²ÑĞµ ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ€Ğ°Ğ·Ğ¾Ğ¼.**

---

## 2. Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ MLflow

MLflow â€” ÑÑ‚Ğ¾ open-source Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¾Ñ‚ Databricks Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ML-ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸. Ğ¡Ğ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· Ñ‡ĞµÑ‚Ñ‹Ñ€Ñ‘Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²:

```
MLflow
â”œâ”€â”€ Tracking     â† Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¼Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ (Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²)
â”œâ”€â”€ Projects     â† ÑƒĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ° ĞºĞ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ (Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼)
â”œâ”€â”€ Models       â† ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾)
â””â”€â”€ Registry     â† Ñ€ĞµĞµÑÑ‚Ñ€ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ° (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ)
```

### Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Tracking (Ğ½Ğ°Ñˆ ĞºĞµĞ¹Ñ):

1. Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ **Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹** â€” Ñ Ñ‡ĞµĞ¼ Ğ¼Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ»Ğ¸ (Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸)
2. Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ **Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸** â€” Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ (RMSE, MAE, R2)
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ **Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹** â€” Ñ„Ğ°Ğ¹Ğ»Ñ‹ (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³, Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸)
4. Ğ”Ğ°Ñ‘Ñ‚ **Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ** â€” ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¸ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ

---

## 3. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° MLflow â€” Ğ²ÑĞµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ¸Ñ

### Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²

```
Tracking Server (ÑĞµÑ€Ğ²ĞµÑ€/Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° mlruns/)
â”‚
â”œâ”€â”€ Experiment: "taxi_fare_prediction"          â† Ğ½Ğ°Ñˆ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚
â”‚   â”œâ”€â”€ Run: abc123  (Ğ·Ğ°Ğ¿ÑƒÑĞº 2024-01-15 10:00)  â† Ğ¾Ğ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿ÑƒÑĞº
â”‚   â”‚   â”œâ”€â”€ Params
â”‚   â”‚   â”‚   â”œâ”€â”€ months = "01,02,03"
â”‚   â”‚   â”‚   â”œâ”€â”€ n_trials = 30
â”‚   â”‚   â”‚   â”œâ”€â”€ hp_learning_rate = 0.0512
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Metrics
â”‚   â”‚   â”‚   â”œâ”€â”€ cv_best_rmse = 3.24
â”‚   â”‚   â”‚   â”œâ”€â”€ rmse = 3.18
â”‚   â”‚   â”‚   â”œâ”€â”€ mae = 2.11
â”‚   â”‚   â”‚   â””â”€â”€ r2 = 0.89
â”‚   â”‚   â””â”€â”€ Artifacts
â”‚   â”‚       â”œâ”€â”€ model/          (MLflow-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸)
â”‚   â”‚       â”œâ”€â”€ model.pkl
â”‚   â”‚       â””â”€â”€ config.json
â”‚   â”‚
â”‚   â”œâ”€â”€ Run: def456  (Ğ·Ğ°Ğ¿ÑƒÑĞº 2024-01-15 14:00)  â† Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ Run: ghi789  (Ğ·Ğ°Ğ¿ÑƒÑĞº 2024-01-16 09:00)
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ Experiment: "taxi_fare_v2"                  â† Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚ (ĞµÑĞ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼)
    â””â”€â”€ ...
```

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Experiment

**Experiment (Ğ­ĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚)** â€” ÑÑ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ². ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğµ Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ ÑÑ‚Ğ°Ğ¿Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°.

Ğ£ Ğ½Ğ°Ñ: `"taxi_fare_prediction"` â€” Ğ²ÑĞµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¸ Ğ¿Ğ¾ Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ‚Ğ°ĞºÑĞ¸.

Ğ•ÑĞ»Ğ¸ Ğ±Ñ‹ Ğ¼Ñ‹ Ğ´ĞµĞ»Ğ°Ğ»Ğ¸ Ğ´Ñ€ÑƒĞ³ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸), Ğ¼Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ»Ğ¸ Ğ±Ñ‹ `"taxi_time_prediction"`.

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Run

**Run (Ğ—Ğ°Ğ¿ÑƒÑĞº)** â€” Ğ¾Ğ´Ğ¸Ğ½ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ğ¾Ğ½ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² `python train_pipeline.py` ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Run Ñ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ID (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, `a3f8c2d1e4b5...`).

Run ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:
- **Start time / End time** â€” ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»ÑÑ Ğ¸ Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ğ»ÑÑ
- **Status** â€” RUNNING, FINISHED, FAILED
- **Source** â€” Ğ¾Ñ‚ĞºÑƒĞ´Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ (Ñ„Ğ°Ğ¹Ğ», git-ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚)
- **Params + Metrics + Artifacts**

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Params (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹)

**Params** â€” Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚, *ĞºĞ°Ğº* Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ.

ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾: **Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ½Ğµ Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ Run**, Ğ¾Ğ½Ğ¸ Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·.

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ½Ğ°ÑˆĞ¸Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²:
```python
"months"              â†’ "01,02,03"      # ĞºĞ°ĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ»Ğ¸
"n_trials"            â†’ 30              # ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ñƒ Optuna
"hp_learning_rate"    â†’ 0.0512          # Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ learning rate Ğ¾Ñ‚ Optuna
"hp_num_leaves"       â†’ 64             # Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ num_leaves Ğ¾Ñ‚ Optuna
"holdout_fraction"    â†’ 0.15           # Ğ´Ğ¾Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸
```

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Metrics (Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸)

**Metrics** â€” Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ğ¼ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¸ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ñ‚ÑŒ.

ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ **Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€Ğ°Ğ·** Ñ ÑˆĞ°Ğ³Ğ¾Ğ¼ (step) â€” Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, loss Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑĞ¿Ğ¾Ñ…Ğµ. Ğ’ Ğ½Ğ°ÑˆĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¾Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· â€” Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹.

ĞĞ°ÑˆĞ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:
```python
"cv_best_rmse"  â†’ 3.24   # Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ RMSE ÑÑ€ĞµĞ´Ğ¸ 30 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Optuna Ğ½Ğ° ĞºÑ€Ğ¾ÑÑ-Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
"rmse"          â†’ 3.18   # RMSE Ğ½Ğ° holdout (Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚)
"mae"           â†’ 2.11   # ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ½Ğ° holdout
"r2"            â†’ 0.89   # ĞºĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° holdout
```

### Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Artifacts (Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹)

**Artifacts** â€” Ğ»ÑĞ±Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ğ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ñ‚ÑŒ Ğº Run.

```
artifacts/
â”œâ”€â”€ model/              â† Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ² MLflow-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· API)
â”‚   â”œâ”€â”€ MLmodel         â† Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”œâ”€â”€ model.lgb       â† Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» LightGBM
â”‚   â””â”€â”€ python_env.yaml â† Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
â”œâ”€â”€ model.pkl           â† Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¸ĞºĞ» (Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸)
â””â”€â”€ config.json         â† ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼Ğ¸ (Ğ´Ğ»Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸)
```

---

## 4. Ğ§Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ¼Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `train_pipeline.py`

#### Ğ”Ğ¾ (Ğ±Ñ‹Ğ»Ğ¾):
```python
def run_pipeline() -> None:
    months = ["01", "02", "03"]
    data_dir = os.path.dirname(os.path.abspath(__file__))
    data_paths = resolve_data(months, dest_dir=data_dir)
    config = Config(data_paths=data_paths)

    processor = DataProcessor(config)
    # ... Ğ²ĞµÑÑŒ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½
    trainer.save(model, config, metrics)
```

#### ĞŸĞ¾ÑĞ»Ğµ (ÑÑ‚Ğ°Ğ»Ğ¾):
```python
import mlflow

def run_pipeline() -> None:
    months = ["01", "02", "03"]
    data_dir = os.path.dirname(os.path.abspath(__file__))
    data_paths = resolve_data(months, dest_dir=data_dir)
    config = Config(data_paths=data_paths)

    # 1. Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ğ¼ MLflow: Ğ²ÑĞµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¸ Ğ¸Ğ´ÑƒÑ‚ Ğ² ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚ "taxi_fare_prediction"
    mlflow.set_experiment("taxi_fare_prediction")

    # 2. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Run â€” Ğ²ÑÑ‘ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ° with Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ¾ Ğº Ğ½ĞµĞ¼Ñƒ
    with mlflow.start_run():

        # 3. Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ°
        mlflow.log_params({
            "months": ",".join(months),          # "01,02,03"
            "n_cv_splits": config.n_cv_splits,   # 5
            "n_trials": config.n_trials,         # 30
            "tuning_sample_fraction": config.tuning_sample_fraction,  # 0.2
            "holdout_fraction": config.holdout_fraction,              # 0.15
            "random_seed": config.random_seed,   # 42
            "high_value_threshold": config.high_value_threshold,     # 500.0
            "max_passengers": config.max_passengers,                 # 10
            "min_fare": config.min_fare,         # 0.0
        })

        # ... Ğ²ĞµÑÑŒ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½ Ğ¾ÑÑ‚Ğ°Ğ»ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
        processor = DataProcessor(config)
        # ...
        trainer.save(model, config, metrics)
    # Run Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğµ Ğ¸Ğ· Ğ±Ğ»Ğ¾ĞºĞ° with
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ `with mlflow.start_run()`?**
ĞšĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ `with` Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾ Run Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ Ğ´Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ´ ÑƒĞ¿Ğ°Ğ´Ñ‘Ñ‚ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹. Run Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ FAILED, Ğ¸ Ğ²Ñ‹ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ ÑÑ‚Ğ¾ Ğ² UI.

---

### Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² `taxi_pipeline/trainer.py`

#### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹:
```python
import mlflow
import mlflow.lightgbm   # ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ LightGBM-Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
```

#### Ğ’ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğµ `tune_hyperparameters()` â€” Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Optuna:

```python
# Ğ‘Ñ‹Ğ»Ğ¾:
return study.best_trial.params

# Ğ¡Ñ‚Ğ°Ğ»Ğ¾:
best_params = study.best_trial.params

# Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ¾Ğ¼ "hp_"
mlflow.log_params({f"hp_{k}": v for k, v in best_params.items()})
# Ğ­Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚: hp_learning_rate, hp_num_leaves, hp_max_depth, Ğ¸ Ñ‚.Ğ´.

# Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ RMSE Ğ½Ğ° ĞºÑ€Ğ¾ÑÑ-Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
mlflow.log_metric("cv_best_rmse", study.best_trial.value)

return best_params
```

**Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ `hp_`?**
Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ² UI Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (`hp_learning_rate`) Ğ¾Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ° (`n_trials`). Ğ‘ĞµĞ· Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ° Ğ²ÑÑ‘ ÑĞ¼ĞµÑˆĞ°ĞµÑ‚ÑÑ Ğ² Ğ¾Ğ´Ğ½Ñƒ ĞºÑƒÑ‡Ñƒ.

#### Ğ’ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğµ `save()`:

```python
# Ğ‘Ñ‹Ğ»Ğ¾:
with open(config.config_save_path, "w") as f:
    json.dump(config_dict, f, indent=2, default=str)

# Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ 4 ÑÑ‚Ñ€Ğ¾ĞºĞ¸):
with open(config.config_save_path, "w") as f:
    json.dump(config_dict, f, indent=2, default=str)

# Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ holdout
mlflow.log_metrics(metrics)
# â†’ rmse: 3.18, mae: 2.11, r2: 0.89

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ² MLflow-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· API)
mlflow.lightgbm.log_model(model, artifact_path="model")

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ°Ğº Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹ (Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğº Run)
mlflow.log_artifact(config.model_save_path)   # model.pkl
mlflow.log_artifact(config.config_save_path) # config.json
```

**Ğ’ Ñ‡Ñ‘Ğ¼ Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ `log_model` Ğ¸ `log_artifact`?**

| | `mlflow.lightgbm.log_model()` | `mlflow.log_artifact()` |
|---|---|---|
| **Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚** | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ² ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ MLflow-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ | ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ»ÑĞ±Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ² Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹ |
| **ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ·** | `mlflow.lightgbm.load_model("runs:/...")` | Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ñ‡ĞµÑ€ĞµĞ· UI |
| **Ğ—Ğ°Ñ‡ĞµĞ¼** | Ğ”Ğ»Ñ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ğ¸ Ğ²ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ | Ğ”Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ»ÑĞ±Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² |

---

## 5. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº

### Ğ¨Ğ°Ğ³ 1: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

```bash
pip install -r requirements.txt
```

Ğ˜Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ MLflow:

```bash
pip install mlflow
```

### Ğ¨Ğ°Ğ³ 2: Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½

```bash
cd /home/user/scaling-train
python train_pipeline.py
```

Ğ’ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğµ Ğ²Ñ‹ ÑƒĞ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ, Ğ¿Ğ»ÑÑ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ²Ñ€Ğ¾Ğ´Ğµ:

```
ğŸƒ View run at: http://127.0.0.1:5000/#/experiments/1/runs/abc123def456
```

### Ğ¨Ğ°Ğ³ 3: Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ MLflow UI

Ğ’ **Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğµ** (Ğ½Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹):

```bash
cd /home/user/scaling-train
mlflow ui
```

Ğ’Ñ‹ ÑƒĞ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ:
```
[INFO] Starting gunicorn 21.2.0
[INFO] Listening at: http://127.0.0.1:5000
```

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€: **http://127.0.0.1:5000**

### Ğ¨Ğ°Ğ³ 4: Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸ÑÑŒ

```bash
ls mlruns/
# Ğ’Ñ‹ ÑƒĞ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ğ¿ĞºÑƒ Ñ Ñ†Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ¼ ID ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°: mlruns/1/
```

---

## 6. MLflow UI â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°

### Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° (ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MLflow                                    [+ New Exp]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Experiments  â”‚                                          â”‚
â”‚              â”‚   taxi_fare_prediction                   â”‚
â”‚ â–¶ taxi_fare_ â”‚   3 runs  |  Last run: 2 hours ago      â”‚
â”‚   prediction â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ° (ÑĞ¿Ğ¸ÑĞ¾Ğº Run'Ğ¾Ğ²)

ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° `taxi_fare_prediction`:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  taxi_fare_prediction                            [Compare] [Download CSV]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  []  â”‚  Run Name   â”‚ Status â”‚  Created â”‚  rmse  â”‚  mae  â”‚   r2   â”‚cv_best_ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  []  â”‚ quirky_doe  â”‚   âœ“    â”‚ 2h ago   â”‚  3.18  â”‚ 2.11  â”‚  0.89  â”‚  3.24   â”‚
â”‚  []  â”‚ brave_hawk  â”‚   âœ“    â”‚ 5h ago   â”‚  3.45  â”‚ 2.38  â”‚  0.86  â”‚  3.51   â”‚
â”‚  []  â”‚ clever_fox  â”‚   âœ—    â”‚ 1d ago   â”‚   â€”    â”‚  â€”    â”‚   â€”    â”‚   â€”     â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Run Name** â€” MLflow Ğ´Ğ°Ñ‘Ñ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° (quirky_doe, brave_hawk)
- **Status âœ“** â€” ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½
- **Status âœ—** â€” ÑƒĞ¿Ğ°Ğ» Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ (Ğ½Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ²ÑÑ‘ Ñ€Ğ°Ğ²Ğ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸ÑÑŒ!)
- Ğ¡Ñ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹ Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ/ÑƒĞ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ

### Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Run'Ğ°

ĞšĞ»Ğ¸ĞºĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸Ğ¼Ñ Run'Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, quirky_doe):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Run: quirky_doe  |  abc123def456...                    â”‚
â”‚  Status: FINISHED  |  Duration: 12m 34s                â”‚
â”‚  Created: 2024-01-15 10:23:41                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PARAMETERS                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ months                  â”‚ 01,02,03             â”‚    â”‚
â”‚  â”‚ n_trials                â”‚ 30                   â”‚    â”‚
â”‚  â”‚ holdout_fraction        â”‚ 0.15                 â”‚    â”‚
â”‚  â”‚ hp_learning_rate        â”‚ 0.0512               â”‚    â”‚
â”‚  â”‚ hp_num_leaves           â”‚ 64                   â”‚    â”‚
â”‚  â”‚ hp_max_depth            â”‚ 7                    â”‚    â”‚
â”‚  â”‚ hp_subsample            â”‚ 0.8341               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  METRICS                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ cv_best_rmse â”‚ 3.2400  â”‚                            â”‚
â”‚  â”‚ rmse         â”‚ 3.1800  â”‚                            â”‚
â”‚  â”‚ mae          â”‚ 2.1100  â”‚                            â”‚
â”‚  â”‚ r2           â”‚ 0.8900  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ARTIFACTS                                              â”‚
â”‚  ğŸ“ model/                                             â”‚
â”‚     â”œâ”€â”€ MLmodel                                        â”‚
â”‚     â”œâ”€â”€ model.lgb                                      â”‚
â”‚     â””â”€â”€ python_env.yaml                                â”‚
â”‚  ğŸ“„ model.pkl                      [Download]          â”‚
â”‚  ğŸ“„ config.json                    [Download]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Ğ§Ñ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğµ Ğ¸ Ğ·Ğ°Ñ‡ĞµĞ¼

### ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ°Ñ€Ñ‚Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```
python train_pipeline.py
â”‚
â”œâ”€â”€ mlflow.set_experiment("taxi_fare_prediction")
â”‚     â””â”€â”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚
â”‚
â””â”€â”€ mlflow.start_run()
      â”‚
      â”œâ”€â”€ [Ğ¡Ñ€Ğ°Ğ·Ñƒ] mlflow.log_params({...})
      â”‚     ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ°:
      â”‚     â€¢ months              â†’ "01,02,03"
      â”‚       (Ğ·Ğ½Ğ°ĞµĞ¼, Ğ½Ğ° ĞºĞ°ĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ğ±ÑƒÑ‡Ğ°Ğ»Ğ¸)
      â”‚     â€¢ n_cv_splits         â†’ 5
      â”‚       (ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ¾Ğ»Ğ´Ğ¾Ğ² ĞºÑ€Ğ¾ÑÑ-Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸)
      â”‚     â€¢ n_trials            â†’ 30
      â”‚       (ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ»Ğ¸ Optuna)
      â”‚     â€¢ tuning_sample_fraction â†’ 0.2
      â”‚       (Ğ½Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ´Ğ¾Ğ»Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ÑĞºĞ°Ğ»Ğ¸ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹)
      â”‚     â€¢ holdout_fraction    â†’ 0.15
      â”‚       (15% Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ñ‹ ĞºĞ°Ğº Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚)
      â”‚     â€¢ random_seed         â†’ 42
      â”‚       (Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
      â”‚     â€¢ high_value_threshold â†’ 500.0
      â”‚       (Ğ¿Ğ¾Ñ€Ğ¾Ğ³ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ°Ğ½Ğ¾Ğ¼Ğ°Ğ»Ğ¸Ğ¹)
      â”‚     â€¢ max_passengers      â†’ 10
      â”‚       (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²)
      â”‚     â€¢ min_fare            â†’ 0.0
      â”‚       (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ)
      â”‚
      â”œâ”€â”€ DataProcessor â†’ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°, Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°, feature engineering
      â”‚     (Ğ±ĞµĞ· MLflow-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ², Ñ‡Ğ¸ÑÑ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
      â”‚
      â”œâ”€â”€ TimeSplitter â†’ Ñ€Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ° Ğ½Ğ° train/holdout
      â”‚     (Ğ±ĞµĞ· MLflow-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²)
      â”‚
      â”œâ”€â”€ trainer.tune_hyperparameters()  [30 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Optuna]
      â”‚     â””â”€â”€ mlflow.log_params({f"hp_{k}": v ...})
      â”‚           Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:
      â”‚           â€¢ hp_learning_rate   â†’ 0.0512
      â”‚           â€¢ hp_num_leaves      â†’ 64
      â”‚           â€¢ hp_max_depth       â†’ 7
      â”‚           â€¢ hp_min_child_samples â†’ 23
      â”‚           â€¢ hp_subsample       â†’ 0.8341
      â”‚           â€¢ hp_colsample_bytree â†’ 0.7612
      â”‚           â€¢ hp_reg_alpha       â†’ 0.0023
      â”‚           â€¢ hp_reg_lambda      â†’ 0.0891
      â”‚     â””â”€â”€ mlflow.log_metric("cv_best_rmse", 3.24)
      â”‚           Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ RMSE ÑÑ€ĞµĞ´Ğ¸ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº Optuna
      â”‚
      â”œâ”€â”€ trainer.train_final_model()  [Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ]
      â”‚     (Ğ±ĞµĞ· MLflow-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ)
      â”‚
      â”œâ”€â”€ trainer.evaluate_holdout()   [Ğ¾Ñ†ĞµĞ½ĞºĞ° Ğ½Ğ° Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…]
      â”‚     (Ğ±ĞµĞ· MLflow-Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº)
      â”‚
      â””â”€â”€ trainer.save()
            â”œâ”€â”€ mlflow.log_metrics({"rmse": 3.18, "mae": 2.11, "r2": 0.89})
            â”‚     Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ½Ğ° holdout
            â”œâ”€â”€ mlflow.lightgbm.log_model(model, "model")
            â”‚     ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ² MLflow-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ
            â”œâ”€â”€ mlflow.log_artifact("model.pkl")
            â”‚     ĞŸĞ¸ĞºĞ»-Ñ„Ğ°Ğ¹Ğ» Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
            â””â”€â”€ mlflow.log_artifact("config.json")
                  ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼Ğ¸
```

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° params Ğ¸ metrics?

**Params** â€” Ğ²ÑÑ‘, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ *Ğ·Ğ°Ğ´Ğ°Ñ‘Ñ‚Ğµ* Ğ´Ğ¾ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ°Ğ¹Ğ¿Ğ»Ğ°Ğ¹Ğ½Ğ° (`n_trials`, `holdout_fraction`)
- ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ (`hp_learning_rate`)

**Metrics** â€” Ğ²ÑÑ‘, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ *Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚Ğµ* Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ:
- `cv_best_rmse` â€” Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€Ğ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
- `rmse`, `mae`, `r2` â€” ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

Ğ­Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾Ğ³Ğ¾ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ² UI.

---

## 8. ĞšĞ°Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½ÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ

### Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 1: Ğ§ĞµÑ€ĞµĞ· MLflow API (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)

```python
import mlflow.lightgbm

# Ğ£Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğµ run_id Ğ¸Ğ· UI (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "abc123def456789...")
run_id = "abc123def456789"

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
model = mlflow.lightgbm.load_model(f"runs:/{run_id}/model")

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ĞºĞ°Ğº Ğ¾Ğ±Ñ‹Ñ‡Ğ½ÑƒÑ sklearn/LightGBM Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
predictions = model.predict(X_new)
```

### Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 2: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Run Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾

```python
import mlflow

# ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ²ÑĞµ runs ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°, ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ RMSE
runs = mlflow.search_runs(
    experiment_names=["taxi_fare_prediction"],
    order_by=["metrics.rmse ASC"],  # Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ RMSE â€” Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹
)

best_run_id = runs.iloc[0]["run_id"]
print(f"Ğ›ÑƒÑ‡ÑˆĞ¸Ğ¹ Run: {best_run_id}, RMSE: {runs.iloc[0]['metrics.rmse']}")

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Run'Ğ°
model = mlflow.lightgbm.load_model(f"runs:/{best_run_id}/model")
```

### Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 3: Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ¸ĞºĞ» (Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾)

```python
import pickle

# Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ model.pkl Ñ‡ĞµÑ€ĞµĞ· UI (Artifacts â†’ model.pkl â†’ Download)
# Ğ˜Ğ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ:
# mlruns/1/<run_id>/artifacts/model.pkl

with open("model.pkl", "rb") as f:
    model = pickle.load(f)

predictions = model.predict(X_new)
```

### Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 4: ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾

```python
import mlflow

client = mlflow.tracking.MlflowClient()

# ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Run
runs = mlflow.search_runs(experiment_names=["taxi_fare_prediction"])
best_run_id = runs.loc[runs["metrics.rmse"].idxmin(), "run_id"]

# Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
local_path = client.download_artifacts(best_run_id, "model.pkl", dst_path="/tmp/")
print(f"ĞœĞ¾Ğ´ĞµĞ»ÑŒ ÑĞºĞ°Ñ‡Ğ°Ğ½Ğ° Ğ²: {local_path}")
```

---

## 9. Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ² â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ»ÑƒÑ‡ÑˆĞµĞ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

### Ğ’ UI: Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ

1. ĞĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ° Ğ¾Ñ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Run'Ğ¾Ğ² Ğ³Ğ°Ğ»Ğ¾Ñ‡ĞºĞ°Ğ¼Ğ¸
2. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ **"Compare"**
3. Ğ£Ğ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ:
   - **Parallel Coordinates Plot** â€” ĞºĞ°Ğº Ğ³Ğ¸Ğ¿ĞµÑ€Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ²Ğ»Ğ¸ÑÑÑ‚ Ğ½Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºÑƒ
   - **Scatter Plot** â€” ĞºĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ»ÑĞ±Ñ‹Ğ¼Ğ¸ Ğ´Ğ²ÑƒĞ¼Ñ Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ½Ğ°Ğ¼Ğ¸
   - **Box Plot** â€” Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº

### Ğ’ UI: ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

```
ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ° "rmse" â†’ ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ RMSE
ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ "Filter" â†’ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼:
  - metrics.rmse < 3.5
  - params.n_trials = "30"
  - status = "FINISHED"
```

### ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾: Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ²

```python
import mlflow
import pandas as pd

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ runs ĞºĞ°Ğº DataFrame
runs_df = mlflow.search_runs(
    experiment_names=["taxi_fare_prediction"],
    filter_string="status = 'FINISHED'",  # Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ğµ
)

# Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹
result = runs_df[[
    "run_id",
    "start_time",
    "metrics.rmse",
    "metrics.mae",
    "metrics.r2",
    "metrics.cv_best_rmse",
    "params.n_trials",
    "params.hp_learning_rate",
    "params.hp_num_leaves",
]].copy()

# Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ RMSE (Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ â€” Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹)
result = result.sort_values("metrics.rmse")

print(result.to_string(index=False))
```

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°:
```
         run_id    start_time  metrics.rmse  metrics.mae  metrics.r2  ...
abc123...         2024-01-15         3.18         2.11        0.89  ...
def456...         2024-01-15         3.45         2.38        0.86  ...
ghi789...         2024-01-16         3.61         2.52        0.84  ...
```

---

## 10. ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ¾Ğ²

Ğ¢ĞµĞ³Ğ¸ â€” ÑÑ‚Ğ¾ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸ Ğ´Ğ»Ñ Run'Ğ¾Ğ². Ğ£Ğ´Ğ¾Ğ±Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸.

```python
with mlflow.start_run():
    mlflow.set_tag("dataset_version", "2023-Q1")
    mlflow.set_tag("model_type", "lightgbm")
    mlflow.set_tag("environment", "local")
    mlflow.set_tag("developer", "vasya_pupkin")
    # ... Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ´
```

ĞŸĞ¾Ñ‚Ğ¾Ğ¼ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ: `tags.developer = "vasya_pupkin"`

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¿Ğ¾ ÑˆĞ°Ğ³Ğ°Ğ¼ (Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸)

Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ, ĞºĞ°Ğº RMSE Ğ¼ĞµĞ½ÑĞ»ÑÑ Ğ¿Ğ¾ Ñ„Ğ¾Ğ»Ğ´Ğ°Ğ¼ ĞºÑ€Ğ¾ÑÑ-Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸:

```python
# Ğ’ objective Optuna (Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ trainer.py), Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ„Ğ¾Ğ»Ğ´Ğ°:
for fold_idx, (train_idx, val_idx) in enumerate(tscv.split(X_sample)):
    # ... Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ...
    fold_rmse = float(np.sqrt(mean_squared_error(y_val, y_pred)))
    mlflow.log_metric("fold_rmse", fold_rmse, step=fold_idx)
```

Ğ’ UI Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº: Ğ¾ÑÑŒ X â€” Ğ½Ğ¾Ğ¼ĞµÑ€ Ñ„Ğ¾Ğ»Ğ´Ğ°, Ğ¾ÑÑŒ Y â€” RMSE.

### ĞĞ²Ñ‚Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (magic one-liner)

MLflow ÑƒĞ¼ĞµĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº:

```python
# ĞĞ´Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞ° â€” Ğ¸ MLflow ÑĞ°Ğ¼ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²ÑÑ‘, Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ sklearn/LightGBM
mlflow.lightgbm.autolog()

# ĞŸĞ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ»ÑĞ±Ğ¾Ğ¹ model.fit() Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ
model = lgb.LGBMRegressor(...)
model.fit(X_train, y_train)
# â†’ MLflow ÑĞ°Ğ¼ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ²ÑĞµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
```

**ĞÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾**: autolog Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ»Ğ¸ÑˆĞ½ĞµĞ³Ğ¾. Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (ĞºĞ°Ğº Ñƒ Ğ½Ğ°Ñ) Ğ´Ğ°Ñ‘Ñ‚ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ.

### Ğ’Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Run'Ñ‹ (parent-child)

Ğ”Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Optuna Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾:

```python
with mlflow.start_run(run_name="main_pipeline") as parent_run:
    for trial_num in range(n_trials):
        with mlflow.start_run(nested=True, run_name=f"trial_{trial_num}"):
            mlflow.log_params(trial_params)
            mlflow.log_metric("trial_rmse", trial_rmse)

    # Ğ’ ĞºĞ¾Ğ½Ñ†Ğµ â€” Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
    mlflow.log_params(best_params)
    mlflow.log_metrics(final_metrics)
```

Ğ’ UI Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Run'Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ ĞºĞ°Ğº Ğ´ĞµÑ€ĞµĞ²Ğ¾.

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

```python
import matplotlib.pyplot as plt

# Feature importance
fig, ax = plt.subplots(figsize=(10, 8))
lgb.plot_importance(model, ax=ax, max_num_features=20)
mlflow.log_figure(fig, "feature_importance.png")
plt.close()

# Scatter plot: predicted vs actual
fig, ax = plt.subplots()
ax.scatter(y_test, y_pred, alpha=0.1)
ax.set_xlabel("Actual fare ($)")
ax.set_ylabel("Predicted fare ($)")
mlflow.log_figure(fig, "predicted_vs_actual.png")
plt.close()
```

ĞšĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¸ Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ² Artifacts â†’ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² UI.

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ğ¾Ğ²

```python
# Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ğµ
dataset = mlflow.data.from_pandas(
    train_df.to_pandas(),
    name="taxi_train",
    targets="fare_amount"
)
mlflow.log_input(dataset, context="training")
```

---

## 11. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ñƒ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ²Ğ¾Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° `mlruns/`

ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ MLflow Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾. Ğ•ÑĞ»Ğ¸ Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº â€” Ğ¸Ñ… Run'Ñ‹ Ğ½Ğ¸ĞºĞ°Ğº Ğ½Ğµ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹.

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 1: ĞĞ±Ñ‰Ğ¸Ğ¹ ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ´Ğ¸ÑĞº / S3

```bash
# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ tracking server Ñ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¼ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰ĞµĞ¼
mlflow server \
    --backend-store-uri postgresql://user:pass@db-host:5432/mlflow \
    --default-artifact-root s3://your-bucket/mlflow-artifacts \
    --host 0.0.0.0 \
    --port 5000
```

Ğ’ ĞºĞ¾Ğ´Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°:
```python
mlflow.set_tracking_uri("http://shared-server:5000")
mlflow.set_experiment("taxi_fare_prediction")
# Ğ”Ğ°Ğ»ÑŒÑˆĞµ Ğ²ÑÑ‘ Ñ‚Ğ¾ Ğ¶Ğµ ÑĞ°Ğ¼Ğ¾Ğµ
```

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 2: ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ shared ÑĞµÑ€Ğ²ĞµÑ€ (SQLite + Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ°)

```bash
# ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:
mlflow server \
    --backend-store-uri sqlite:///mlflow.db \
    --default-artifact-root /shared/mlflow-artifacts \
    --host 0.0.0.0 \
    --port 5000
```

Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ÑÑ‚ÑÑ:
```python
mlflow.set_tracking_uri("http://192.168.1.100:5000")
```

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 3: ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (ÑƒĞ´Ğ¾Ğ±Ğ½ĞµĞµ Ğ²ÑĞµĞ³Ğ¾)

ĞĞµ Ğ¼ĞµĞ½ÑÑ‚ÑŒ ĞºĞ¾Ğ´ â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ:

```bash
export MLFLOW_TRACKING_URI="http://shared-server:5000"
python train_pipeline.py  # Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
```

---

## 12. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ

ĞŸĞ¾ÑĞ»Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ² ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° `mlruns/` Ğ±ÑƒĞ´ĞµÑ‚ Ñ‚Ğ°ĞºĞ¾Ğ¹:

```
scaling-train/
â”‚
â”œâ”€â”€ mlruns/                                    â† ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° MLflow
â”‚   â”œâ”€â”€ .trash/                                â† ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğµ Run'Ñ‹
â”‚   â””â”€â”€ 1/                                     â† ID ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ° "taxi_fare_prediction"
â”‚       â”œâ”€â”€ meta.yaml                          â† Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°
â”‚       â”‚
â”‚       â”œâ”€â”€ abc123def456789.../                â† Run 1 (quirky_doe)
â”‚       â”‚   â”œâ”€â”€ meta.yaml                      â† Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Run'Ğ°
â”‚       â”‚   â”œâ”€â”€ params/
â”‚       â”‚   â”‚   â”œâ”€â”€ months                     â† Ñ„Ğ°Ğ¹Ğ» Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼ "01,02,03"
â”‚       â”‚   â”‚   â”œâ”€â”€ n_trials                   â† Ñ„Ğ°Ğ¹Ğ» Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼ "30"
â”‚       â”‚   â”‚   â”œâ”€â”€ hp_learning_rate           â† Ñ„Ğ°Ğ¹Ğ» Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼ "0.0512"
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ metrics/
â”‚       â”‚   â”‚   â”œâ”€â”€ cv_best_rmse               â† "1705312345 3.24 0" (timestamp value step)
â”‚       â”‚   â”‚   â”œâ”€â”€ rmse                       â† "1705312456 3.18 0"
â”‚       â”‚   â”‚   â”œâ”€â”€ mae                        â† "1705312456 2.11 0"
â”‚       â”‚   â”‚   â””â”€â”€ r2                         â† "1705312456 0.89 0"
â”‚       â”‚   â”œâ”€â”€ tags/
â”‚       â”‚   â”‚   â”œâ”€â”€ mlflow.runName             â† "quirky_doe"
â”‚       â”‚   â”‚   â”œâ”€â”€ mlflow.source.name         â† "train_pipeline.py"
â”‚       â”‚   â”‚   â””â”€â”€ mlflow.source.git.commit   â† "abc123..." (Ñ…ÑÑˆ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°!)
â”‚       â”‚   â””â”€â”€ artifacts/
â”‚       â”‚       â”œâ”€â”€ model/
â”‚       â”‚       â”‚   â”œâ”€â”€ MLmodel
â”‚       â”‚       â”‚   â”œâ”€â”€ model.lgb
â”‚       â”‚       â”‚   â”œâ”€â”€ python_env.yaml
â”‚       â”‚       â”‚   â””â”€â”€ requirements.txt
â”‚       â”‚       â”œâ”€â”€ model.pkl
â”‚       â”‚       â””â”€â”€ config.json
â”‚       â”‚
â”‚       â””â”€â”€ def456ghi789012.../                â† Run 2 (brave_hawk)
â”‚           â””â”€â”€ ...
â”‚
â”œâ”€â”€ taxi_pipeline/
â”œâ”€â”€ train_pipeline.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ model.pkl                                  â† Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ!)
â””â”€â”€ config.json                                â† Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ (Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ!)
```

> **Ğ’Ğ°Ğ¶Ğ½Ğ¾**: `model.pkl` Ğ¸ `config.json` Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ.
> ĞĞ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² `mlruns/<run_id>/artifacts/`.

---

## 13. Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Ğ¸Ñ… Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

### ĞÑˆĞ¸Ğ±ĞºĞ°: `mlflow.exceptions.MlflowException: Run ... is not active`

```
MlflowException: Run abc123 is not active. Only active runs can be logged to.
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: Ğ²Ñ‹ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚Ğµ `mlflow.log_*` Ğ²Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ° `with mlflow.start_run()`.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: ÑƒĞ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ MLflow Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ `with mlflow.start_run():`.

---

### ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ğ² UI

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: `mlflow.log_params()` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ *Ğ¿Ğ¾ÑĞ»Ğµ* Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Run'Ğ°.

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°**:
```python
with mlflow.start_run():
    mlflow.log_params({"key": "value"})  # âœ“ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ° â€” Ğ²ÑÑ‘ OK

mlflow.log_params({"key": "value"})      # âœ— Ğ²Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ° â€” Ğ¾ÑˆĞ¸Ğ±ĞºĞ°!
```

---

### ĞÑˆĞ¸Ğ±ĞºĞ°: `MlflowException: Param 'hp_learning_rate' was already logged`

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°**: Ğ²Ñ‹ Ğ¿Ñ‹Ñ‚Ğ°ĞµÑ‚ĞµÑÑŒ Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸ Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ´Ğ²Ğ°Ğ¶Ğ´Ñ‹ Ğ² Ğ¾Ğ´Ğ¸Ğ½ Run.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ¼ĞµĞ½Ğ° Ğ¸Ğ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·.

---

### ĞÑˆĞ¸Ğ±ĞºĞ°: UI Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ, Ğ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ½ÑÑ‚

```bash
# Ğ”Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚:
mlflow ui --port 8080

# Ğ˜Ğ»Ğ¸ ÑƒĞ±Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 5000:
lsof -ti:5000 | xargs kill -9
```

---

### ĞÑˆĞ¸Ğ±ĞºĞ°: Run Ğ·Ğ°ÑÑ‚Ñ€ÑĞ» Ğ² ÑÑ‚Ğ°Ñ‚ÑƒÑĞµ RUNNING

Ğ­Ñ‚Ğ¾ Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚, ĞµÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ ÑƒĞ¿Ğ°Ğ» Ğ±ĞµĞ· ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Run'Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, kill -9).

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**:
```python
import mlflow
client = mlflow.tracking.MlflowClient()

# ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ run_id Ğ² UI
client.set_terminated("your_run_id_here", status="FAILED")
```

---

### ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ, Ğ¿Ğ°Ğ¿ĞºĞ° mlruns/ Ñ€Ğ°Ğ·Ñ€Ğ°ÑÑ‚Ğ°ĞµÑ‚ÑÑ

```bash
# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€:
du -sh mlruns/

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Run'Ñ‹ Ñ‡ĞµÑ€ĞµĞ· UI (Experiments â†’ Ğ¾Ñ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Run â†’ Delete)
# Ğ˜Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾:
import mlflow
client = mlflow.tracking.MlflowClient()
client.delete_run("run_id_to_delete")
```

---

## 14. Ğ¨Ğ¿Ğ°Ñ€Ğ³Ğ°Ğ»ĞºĞ° Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼

### Ğ—Ğ°Ğ¿ÑƒÑĞº

```bash
# ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ MLflow
python train_pipeline.py

# Ğ—Ğ°Ğ¿ÑƒÑĞº UI (ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹)
mlflow ui

# Ğ—Ğ°Ğ¿ÑƒÑĞº UI Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ Ğ¿Ğ¾Ñ€Ñ‚Ñƒ
mlflow ui --port 8080

# Ğ—Ğ°Ğ¿ÑƒÑĞº UI Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞ¾Ğ¹
mlflow ui --backend-store-uri ./mlruns

# Ğ—Ğ°Ğ¿ÑƒÑĞº shared ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
mlflow server --backend-store-uri sqlite:///mlruns.db --host 0.0.0.0 --port 5000
```

### CLI ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹

```bash
# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²
mlflow experiments list

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚
mlflow experiments create --experiment-name "my_experiment"

# Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Run'Ğ¾Ğ² ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ°
mlflow runs list --experiment-id 1

# Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Run'Ğ°
mlflow artifacts download --run-id abc123 --artifact-path model

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Run
mlflow runs delete --run-id abc123
```

### Python API

```python
import mlflow

# Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
mlflow.set_tracking_uri("http://localhost:5000")    # Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ
mlflow.set_experiment("taxi_fare_prediction")        # Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚

with mlflow.start_run(run_name="my_run"):            # Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Run
    mlflow.log_param("key", "value")                # Ğ¾Ğ´Ğ¸Ğ½ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€
    mlflow.log_params({"k1": "v1", "k2": "v2"})    # Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
    mlflow.log_metric("rmse", 3.18)                 # Ğ¾Ğ´Ğ½Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°
    mlflow.log_metrics({"rmse": 3.18, "mae": 2.11}) # Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
    mlflow.log_metric("loss", 0.5, step=10)         # Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ° Ñ ÑˆĞ°Ğ³Ğ¾Ğ¼
    mlflow.set_tag("env", "production")             # Ñ‚ĞµĞ³
    mlflow.log_artifact("file.pkl")                 # Ñ„Ğ°Ğ¹Ğ»-Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚
    mlflow.lightgbm.log_model(model, "model")       # LightGBM-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ

# ĞŸĞ¾Ğ¸ÑĞº Run'Ğ¾Ğ²
runs = mlflow.search_runs(
    experiment_names=["taxi_fare_prediction"],
    filter_string="metrics.rmse < 3.5 AND status = 'FINISHED'",
    order_by=["metrics.rmse ASC"],
    max_results=10,
)

# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
model = mlflow.lightgbm.load_model("runs:/abc123/model")

# ĞĞ²Ñ‚Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
mlflow.lightgbm.autolog()
```

---

## Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: Ğ·Ğ°Ñ‡ĞµĞ¼ Ğ²ÑÑ‘ ÑÑ‚Ğ¾?

```
Ğ‘ĞµĞ· MLflow                          Ğ¡ MLflow
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"ĞšĞ°ĞºĞ¾Ğ¹ Ğ±Ñ‹Ğ» RMSE Ğ² Ñ‚Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ?"     ĞÑ‚ĞºÑ€Ñ‹Ğ» UI â†’ Ğ½Ğ°ÑˆÑ‘Ğ» Ğ·Ğ° 5 ÑĞµĞºÑƒĞ½Ğ´
"Ğ¡ ĞºĞ°ĞºĞ¸Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸ Ğ¾Ğ±ÑƒÑ‡Ğ°Ğ»Ğ¸?"     Ğ’ÑÑ‘ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¾ â†’ params Ğ² UI
"ĞšĞ°ĞºĞ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ»ÑƒÑ‡ÑˆĞ°Ñ?"              Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ rmse â†’ Ğ¿ĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ°
"ĞœĞ¾Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚?"   run_id â†’ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾
"Ğ“Ğ´Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸?"     Artifacts â†’ ÑĞºĞ°Ñ‡Ğ°Ğ» Ğ·Ğ° 2 ĞºĞ»Ğ¸ĞºĞ°
"ĞšĞ°Ğº ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ²Ğ° Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°?"         Compare â†’ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
```

**MLflow â€” ÑÑ‚Ğ¾ "git Ğ´Ğ»Ñ ML-ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²".**
Ğ¢Ğ°Ğº Ğ¶Ğµ ĞºĞ°Ğº git Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ĞºĞ¾Ğ´Ğ°, MLflow Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ².

---

*ĞœĞµÑ‚Ğ¾Ğ´Ğ¸Ñ‡ĞºĞ° Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° `scaling-train` (NYC Taxi Fare Prediction)*
*LightGBM + Optuna + Polars + MLflow*
